-- Generated by Mocodo 4.2.12

DROP DATABASE IF EXISTS LibrairieExpress;
CREATE DATABASE IF NOT EXISTS LibrairieExpress;
USE LibrairieExpress;

DROP TABLE IF EXISTS AFFILIATION;
DROP TABLE IF EXISTS THEMES;
DROP TABLE IF EXISTS POSSEDER;
DROP TABLE IF EXISTS EDITER;
DROP TABLE IF EXISTS ECRIRE;
DROP TABLE IF EXISTS DETAILCOMMANDE;
DROP TABLE IF EXISTS COMMANDE;
DROP TABLE IF EXISTS CLIENT;
DROP TABLE IF EXISTS MAGASIN;
DROP TABLE IF EXISTS LIVRE;
DROP TABLE IF EXISTS EDITEUR;
DROP TABLE IF EXISTS AUTEUR;
DROP TABLE IF EXISTS CLASSIFICATION;
DROP TABLE IF EXISTS VENDEUR;
DROP TABLE IF EXISTS ADMINISTRATEUR;



CREATE TABLE IF NOT EXISTS ADMINISTRATEUR(
  PRIMARY KEY (keyAdmin),
  keyAdmin int NOT NULL,
  identAdmin varchar(32) NOT NULL,
  motdepasseAdmin varchar(32) NOT NULL,
  email varchar(32) NOT NULL
);

CREATE TABLE IF NOT EXISTS VENDEUR(
  PRIMARY KEY (keyVendeur),
  keyVendeur int NOT NULL,
  identVendeur varchar(32) NOT NULL,
  motdepasseVendeur varchar(32)NOT NULL,
  email varchar(32) NOT NULL
);

CREATE TABLE IF NOT EXISTS AUTEUR (
  PRIMARY KEY (idauteur),
  idauteur   varchar(11) NOT NULL,
  nomauteur  varchar(100) NOT NULL,
  anneenais  int,
  anneedeces int
);

CREATE TABLE IF NOT EXISTS CLASSIFICATION (
  PRIMARY KEY (iddewey),
  iddewey  varchar(3) NOT NULL,
  nomclass varchar(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS CLIENT (
  PRIMARY KEY (idcli),
  idcli      int NOT NULL,
  nomcli     varchar(50) NOT NULL,
  prenomcli  varchar(30) NOT NULL,
  adressecli varchar(100) NOT NULL,
  codepostal varchar(5) NOT NULL,
  villecli   varchar(100) NOT NULL
);

CREATE TABLE IF NOT EXISTS COMMANDE (
  PRIMARY KEY (numcom),
  numcom  int NOT NULL,
  datecom date NOT NULL,
  enligne char(1) NOT NULL,
  livraison char(1) NOT NULL,
  idcli   int NOT NULL,
  idmag   VARCHAR(42) NOT NULL
);

CREATE TABLE IF NOT EXISTS DETAILCOMMANDE (
  PRIMARY KEY (numcom, numlig),
  numcom    int NOT NULL,
  numlig    int NOT NULL,
  qte       int,
  prixvente decimal(6,2),
  isbn      varchar(13) NOT NULL
);

CREATE TABLE IF NOT EXISTS ECRIRE (
  PRIMARY KEY (isbn, idauteur),
  isbn     varchar(13) NOT NULL,
  idauteur varchar(11) NOT NULL
);

CREATE TABLE IF NOT EXISTS EDITER (
  PRIMARY KEY (isbn, idedit),
  isbn   varchar(13) NOT NULL,
  idedit int NOT NULL
);

CREATE TABLE IF NOT EXISTS EDITEUR (
  PRIMARY KEY (idedit),
  idedit  int NOT NULL,
  nomedit varchar(100)
);

CREATE TABLE IF NOT EXISTS LIVRE (
  PRIMARY KEY (isbn),
  isbn      varchar(13) NOT NULL,
  titre     varchar(200) NOT NULL,
  nbpages   int,
  datepubli int,
  prix      decimal(6,2)
);

CREATE TABLE IF NOT EXISTS MAGASIN (
  PRIMARY KEY (idmag),
  idmag    VARCHAR(42) NOT NULL,
  nommag   VARCHAR(42) NOT NULL,
  villemag VARCHAR(42) NOT NULL
);

CREATE TABLE IF NOT EXISTS POSSEDER (
  PRIMARY KEY (idmag, isbn),
  idmag VARCHAR(42) NOT NULL,
  isbn  varchar(13) NOT NULL,
  qte   int
);

CREATE TABLE IF NOT EXISTS THEMES (
  PRIMARY KEY (isbn, iddewey),
  isbn    varchar(13) NOT NULL,
  iddewey varchar(3) NOT NULL
);

CREATE TABLE IF NOT EXISTS AFFILIATION (
    PRIMARY KEY (idmag, keyVendeur),
    idmag VARCHAR(42) NOT NULL,
    keyVendeur INT NOT NULL
);

ALTER TABLE COMMANDE ADD FOREIGN KEY (idmag) REFERENCES MAGASIN (idmag);
ALTER TABLE COMMANDE ADD FOREIGN KEY (idcli) REFERENCES CLIENT (idcli);

ALTER TABLE DETAILCOMMANDE ADD FOREIGN KEY (isbn) REFERENCES LIVRE (isbn);
ALTER TABLE DETAILCOMMANDE ADD FOREIGN KEY (numcom) REFERENCES COMMANDE (numcom);

ALTER TABLE ECRIRE ADD FOREIGN KEY (idauteur) REFERENCES AUTEUR (idauteur);
ALTER TABLE ECRIRE ADD FOREIGN KEY (isbn) REFERENCES LIVRE (isbn);

ALTER TABLE EDITER ADD FOREIGN KEY (idedit) REFERENCES EDITEUR (idedit);
ALTER TABLE EDITER ADD FOREIGN KEY (isbn) REFERENCES LIVRE (isbn);

ALTER TABLE POSSEDER ADD FOREIGN KEY (isbn) REFERENCES LIVRE (isbn);
ALTER TABLE POSSEDER ADD FOREIGN KEY (idmag) REFERENCES MAGASIN (idmag);

ALTER TABLE THEMES ADD FOREIGN KEY (iddewey) REFERENCES CLASSIFICATION (iddewey);
ALTER TABLE THEMES ADD FOREIGN KEY (isbn) REFERENCES LIVRE (isbn);

ALTER TABLE AFFILIATION ADD FOREIGN KEY (idmag) REFERENCES MAGASIN (idmag);
ALTER TABLE AFFILIATION ADD FOREIGN KEY (keyVendeur) REFERENCES VENDEUR (keyVendeur);